<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Nutrition Login</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Inter&display=swap" rel="stylesheet" />
<style>
  body, html {
    margin:0; padding:0; height:100%; font-family: 'Inter', sans-serif;
    background: #279961;
    display: flex; justify-content: center; align-items: center;
  }
  .container {
    background: white;
    border-radius: 16px;
    width: 400px;
    padding: 2.5rem;
    box-shadow: 0 12px 28px rgba(0,0,0,0.2);
    text-align: center;
  }
  h2 {
    margin-bottom: 1.5rem;
    font-family: 'Montserrat', sans-serif;
    color: #279961;
  }
  form {
    display: flex; flex-direction: column;
    gap: 1rem;
    max-height: 650px;
    overflow-y: auto;
  }
  input[type="text"], input[type="email"], input[type="password"], input[type="number"], select {
    padding: 0.8rem 1rem;
    font-size: 1rem;
    border: 2px solid #279961;
    border-radius: 10px;
    outline: none;
    transition: border-color 0.3s;
  }
  input[type="text"]:focus, input[type="email"]:focus, input[type="password"]:focus,
  input[type="number"]:focus, select:focus {
    border-color: #196530;
  }
  label.checkbox-label {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-weight: 600;
    color: #279961;
  }
  fieldset {
    border: 1px solid #279961;
    border-radius: 10px;
    padding: 1rem;
  }
  legend {
    font-weight: 700;
    color: #279961;
  }
  button {
    padding: 1rem;
    background: #279961;
    border: none;
    border-radius: 40px;
    color: white;
    font-weight: 700;
    font-size: 1.1rem;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover {
    background: #1e6e45;
  }
  .switch-mode {
    margin-top: 1rem;
    color: #27a86a;
    cursor: pointer;
    font-weight: 600;
  }
  .switch-mode:hover {
    text-decoration: underline;
  }
  .error {
    color: #e74c3c;
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: none;
  }
</style>
</head>
<body>
  <div class="container" role="main" aria-label="Login and Signup form">
    <h2 id="formTitle">Login</h2>

    <div class="error" id="errorMsg"></div>

    <form id="authForm" novalidate>
      <!-- Signup extra fields -->
      <input type="text" id="fullName" name="fullName" placeholder="Full Name" style="display:none;" aria-label="Full name" />
      <input type="number" id="age" name="age" placeholder="Age" min="1" max="120" style="display:none;" aria-label="Age" />
      <input type="number" id="weight" name="weight" placeholder="Weight (kg)" min="1" max="500" style="display:none;" aria-label="Weight" />
      <input type="number" id="height" name="height" placeholder="Height (cm)" min="30" max="300" style="display:none;" aria-label="Height" />

      <!-- Health Conditions -->
      <fieldset id="healthConditions" style="display:none;">
        <legend>Health Condition</legend>
        <label class="checkbox-label"><input type="checkbox" name="healthCondition" value="Cholesterol"/> Cholesterol</label>
        <label class="checkbox-label"><input type="checkbox" name="healthCondition" value="Hypertension"/> Hypertension</label>
        <label class="checkbox-label"><input type="checkbox" name="healthCondition" value="Food Allergies"/> Food Allergies</label>
        <label class="checkbox-label"><input type="checkbox" name="healthCondition" value="Diabetes"/> Diabetes</label>
      </fieldset>

      <!-- Lifestyle -->
      <select id="lifestyle" name="lifestyle" style="display:none;" aria-label="Lifestyle">
        <option value="" disabled selected>Select Lifestyle</option>
        <option value="Active">Active</option>
        <option value="Sedentary">Sedentary</option>
        <option value="Moderately Active">Moderately Active</option>
        <option value="Lightly Active">Lightly Active</option>
      </select>

      <input type="email" id="email" name="email" placeholder="Email address" required aria-label="Email address" />
      <input type="password" id="password" name="password" placeholder="Password" required aria-label="Password" />

      <button type="submit" id="submitBtn">Login</button>
    </form>

    <div class="switch-mode" id="toggleModeBtn" tabindex="0" role="button" aria-pressed="false">Don't have an account? Sign Up</div>
  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const formTitle = document.getElementById('formTitle');
    const toggleModeBtn = document.getElementById('toggleModeBtn');
    const authForm = document.getElementById('authForm');
    const fullNameInput = document.getElementById('fullName');
    const ageInput = document.getElementById('age');
    const weightInput = document.getElementById('weight');
    const heightInput = document.getElementById('height');
    const healthConditionsFieldset = document.getElementById('healthConditions');
    const lifestyleSelect = document.getElementById('lifestyle');
    const submitBtn = document.getElementById('submitBtn');
    const errorMsg = document.getElementById('errorMsg');

    let isLogin = true;

    function clearError() {
      errorMsg.style.display = 'none';
      errorMsg.textContent = '';
    }

    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
    }

    toggleModeBtn.addEventListener('click', () => {
      isLogin = !isLogin;
      clearError();
      if (isLogin) {
        formTitle.textContent = "Login";
        fullNameInput.style.display = 'none';
        ageInput.style.display = 'none';
        weightInput.style.display = 'none';
        heightInput.style.display = 'none';
        healthConditionsFieldset.style.display = 'none';
        lifestyleSelect.style.display = 'none';
        submitBtn.textContent = "Login";
        toggleModeBtn.textContent = "Don't have an account? Sign Up";
      } else {
        formTitle.textContent = "Sign Up";
        fullNameInput.style.display = 'block';
        ageInput.style.display = 'block';
        weightInput.style.display = 'block';
        heightInput.style.display = 'block';
        healthConditionsFieldset.style.display = 'block';
        lifestyleSelect.style.display = 'block';
        submitBtn.textContent = "Sign Up";
        toggleModeBtn.textContent = "Already have an account? Login";
      }
    });

    toggleModeBtn.addEventListener('keydown', (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleModeBtn.click();
      }
    });

    authForm.addEventListener('submit', e => {
      e.preventDefault();
      clearError();

      const email = authForm.email.value.trim();
      const password = authForm.password.value.trim();

      if (!email || !password) {
        showError("Please fill in all required fields.");
        return;
      }

      if (!validateEmail(email)) {
        showError("Please enter a valid email address.");
        return;
      }

      if (!isLogin) {
        const fullName = fullNameInput.value.trim();
        const age = ageInput.value.trim();
        const weight = weightInput.value.trim();
        const height = heightInput.value.trim();
        const checkedConditions = Array.from(healthConditionsFieldset.querySelectorAll('input[type=checkbox]:checked')).map(cb => cb.value);
        const lifestyle = lifestyleSelect.value;

        if (!fullName) {
          showError("Please enter your full name.");
          return;
        }
        if (!age) {
          showError("Please enter your age.");
          return;
        }
        if (!weight) {
          showError("Please enter your weight.");
          return;
        }
        if (!height) {
          showError("Please enter your height.");
          return;
        }
        if (!lifestyle) {
          showError("Please select your lifestyle.");
          return;
        }
        // For demo: save all info in localStorage
        localStorage.setItem('userName', fullName);
        localStorage.setItem('userEmail', email);
        localStorage.setItem('userAge', age);
        localStorage.setItem('userWeight', weight);
        localStorage.setItem('userHeight', height);
        localStorage.setItem('userHealthConditions', JSON.stringify(checkedConditions));
        localStorage.setItem('userLifestyle', lifestyle);
      } else {
        // Login check for demo
        const storedEmail = localStorage.getItem('userEmail') || "";
        if (storedEmail.toLowerCase() !== email.toLowerCase()) {
          showError("Email not found. Please sign up first.");
          return;
        }
      }

      const userName = isLogin ? (localStorage.getItem('userName') || "Smart User") : fullNameInput.value.trim();
      localStorage.setItem('userName', userName);

      window.location.href = "smart-nutrition-frontend.html";
    });

    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }
  });
</script>
</body>
</html>
